--- a/tftp.c	2021-06-16 03:02:16.000000000 -0700
+++ b/tftp.c	2021-10-26 15:39:00.272020185 -0700
@@ -75,6 +75,17 @@
 //config:	Allow tftp to specify block size, and tftpd to understand
 //config:	"blksize" and "tsize" options.
 //config:
+//config:config FEATURE_TFTP_UMASK
+//config:	hex "UMASK for TFTP client and server to use"
+//config:	default 0x1b6
+//config:	depends on TFTP || TFTPD
+//config:	help
+//config:	Specify the UMASK to be used for new files being transferred
+//config:	via TFTP. Defaults to 0x1b6 (0666). Use 0x1ff (0777) if you
+//config:	want execute permissions on transferred files.
+//config:	(Must be specified in hex, since Kconfig doesn't support octal
+//config:	fields.)
+//config:
 //config:config TFTP_DEBUG
 //config:	bool "Enable debug"
 //config:	default n
@@ -394,7 +405,7 @@
 				open_mode = O_WRONLY | O_TRUNC;
 			}
 		}
-		local_fd = open(local_file, open_mode, 0666);
+		local_fd = open(local_file, open_mode, CONFIG_FEATURE_TFTP_UMASK);
 		if (local_fd < 0) {
 			/* sanitize name, it came from untrusted remote side */
 			unsigned char *p = (void *) local_file;
@@ -691,7 +702,8 @@
 				if (local_fd == -1) {
 					local_fd = STDOUT_FILENO;
 					if (local_file)
-						local_fd = xopen(local_file, O_WRONLY | O_TRUNC | O_CREAT);
+						local_fd = xopen3(local_file, O_WRONLY | O_TRUNC | O_CREAT,
+							CONFIG_FEATURE_TFTP_UMASK);
 				}
 				sz = full_write(local_fd, &rbuf[4], len - 4);
 				if (sz != len - 4) {
